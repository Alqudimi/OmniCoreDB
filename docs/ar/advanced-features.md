# الميزات المتقدمة - Omni Core DB Manager

## المحتويات

1. [العمليات الجماعية](#العمليات-الجماعية)
2. [إدارة الفهارس المتقدمة](#إدارة-الفهارس-المتقدمة)
3. [القيود والعلاقات](#القيود-والعلاقات)
4. [تحليل الأداء](#تحليل-الأداء)
5. [التحقق من صحة البيانات](#التحقق-من-صحة-البيانات)
6. [النسخ الاحتياطي المتقدم](#النسخ-الاحتياطي-المتقدم)
7. [تحليل الجداول](#تحليل-الجداول)

## العمليات الجماعية

### الإدخال الجماعي (Bulk Insert)

#### الاستخدام الأساسي
```json
[
  {"name": "أحمد", "email": "ahmed@example.com", "age": 30},
  {"name": "فاطمة", "email": "fatima@example.com", "age": 25},
  {"name": "محمد", "email": "mohamed@example.com", "age": 35}
]
```

#### مع القيم الافتراضية
```json
[
  {"name": "سارة", "email": "sarah@example.com"},
  {"name": "علي", "email": "ali@example.com"}
]
```

**ملاحظة**: الحقول المحذوفة ستأخذ القيم الافتراضية.

#### مع البيانات المعقدة
```json
[
  {
    "product_name": "لابتوب",
    "price": 3500.00,
    "specs": {
      "cpu": "Intel i7",
      "ram": "16GB",
      "storage": "512GB SSD"
    },
    "tags": ["electronics", "computers"]
  }
]
```

### التحديث الجماعي (Bulk Update)

#### تحديث بشرط بسيط
```json
{
  "where": {"status": "pending"},
  "updates": {"status": "completed"}
}
```

#### تحديث متعدد الحقول
```json
{
  "where": {"created_at": {"<": "2024-01-01"}},
  "updates": {
    "status": "archived",
    "archived_at": "2024-10-02"
  }
}
```

#### تحديث بشروط معقدة
```json
{
  "where": {
    "AND": [
      {"age": {">": 18}},
      {"status": "active"}
    ]
  },
  "updates": {"category": "adult"}
}
```

### الحذف الجماعي (Bulk Delete)

#### حذف بمعرّفات محددة
```json
{
  "ids": [1, 2, 3, 4, 5]
}
```

#### حذف بشرط
```json
{
  "where": {"created_at": {"<": "2023-01-01"}}
}
```

## إدارة الفهارس المتقدمة

### أنواع الفهارس

#### 1. الفهرس البسيط (Simple Index)
```sql
CREATE INDEX idx_username ON users(username);
```

**متى تستخدمه**:
- للبحث السريع في عمود واحد
- للفرز بعمود معين

#### 2. الفهرس المركب (Composite Index)
```sql
CREATE INDEX idx_name_email ON users(name, email);
```

**متى تستخدمه**:
- عند البحث بعدة أعمدة معاً
- ترتيب الأعمدة مهم!

#### 3. الفهرس الفريد (Unique Index)
```sql
CREATE UNIQUE INDEX idx_unique_email ON users(email);
```

**متى تستخدمه**:
- لضمان عدم تكرار القيم
- للمفاتيح البديلة

#### 4. الفهرس الجزئي (Partial Index)
```sql
CREATE INDEX idx_active_users ON users(created_at) WHERE status = 'active';
```

**متى تستخدمه**:
- للفهرسة الانتقائية
- لتوفير المساحة

### استراتيجيات الفهرسة

#### قاعدة الأعمدة اليسرى (Leftmost Prefix)
إذا كان لديك فهرس مركب على (A, B, C):
- ✅ يعمل مع: A
- ✅ يعمل مع: A, B
- ✅ يعمل مع: A, B, C
- ❌ لا يعمل مع: B أو C أو B, C

#### نصائح الفهرسة
1. **افهرس أعمدة WHERE**: الأعمدة المستخدمة في الشروط
2. **افهرس أعمدة JOIN**: أعمدة الربط بين الجداول
3. **افهرس أعمدة ORDER BY**: للفرز السريع
4. **لا تفرط**: كل فهرس يبطئ INSERT/UPDATE/DELETE

### اقتراحات الفهارس التلقائية

#### كيف يعمل
1. النظام يحلل الاستعلامات البطيئة
2. يكتشف الأعمدة المستخدمة كثيراً
3. يقترح فهارس لتحسين الأداء

#### مثال على الاقتراح
```
الاستعلام: SELECT * FROM orders WHERE customer_id = 123 AND status = 'pending'
الاقتراح: CREATE INDEX idx_orders_customer_status ON orders(customer_id, status)
التحسن المتوقع: 10x أسرع
```

## القيود والعلاقات

### أنواع القيود

#### 1. المفتاح الأساسي (Primary Key)
```sql
ALTER TABLE users ADD CONSTRAINT pk_users PRIMARY KEY (id);
```

**الخصائص**:
- قيمة فريدة
- لا تقبل NULL
- جدول واحد له مفتاح أساسي واحد فقط

#### 2. المفتاح الخارجي (Foreign Key)
```sql
ALTER TABLE orders ADD CONSTRAINT fk_customer 
  FOREIGN KEY (customer_id) REFERENCES customers(id)
  ON DELETE CASCADE
  ON UPDATE CASCADE;
```

**خيارات ON DELETE**:
- `CASCADE`: حذف الصفوف المرتبطة
- `SET NULL`: تعيين NULL
- `RESTRICT`: منع الحذف
- `NO ACTION`: لا شيء

#### 3. القيد الفريد (Unique)
```sql
ALTER TABLE users ADD CONSTRAINT unique_email UNIQUE (email);
```

**الاستخدام**:
- لضمان عدم تكرار القيم
- يسمح بقيمة NULL واحدة (في معظم قواعد البيانات)

#### 4. قيد الفحص (Check)
```sql
ALTER TABLE products ADD CONSTRAINT check_price 
  CHECK (price > 0 AND price < 1000000);
```

**أمثلة**:
```sql
-- التحقق من العمر
CHECK (age >= 18 AND age <= 120)

-- التحقق من التاريخ
CHECK (end_date > start_date)

-- التحقق من القيم المسموحة
CHECK (status IN ('pending', 'active', 'completed'))
```

### عرض العلاقات

#### مخطط العلاقات (ER Diagram)
1. انقر على "Relationships"
2. اختر جدول
3. شاهد جميع العلاقات:
   - العلاقات الصادرة (المفاتيح الخارجية)
   - العلاقات الواردة (الجداول المرتبطة)

#### أنواع العلاقات
- **1:1** (One to One): مستخدم ↔ ملف شخصي
- **1:N** (One to Many): عميل ↔ طلبات
- **N:M** (Many to Many): طلاب ↔ مواد (عبر جدول وسيط)

## تحليل الأداء

### مراقبة الاستعلامات البطيئة

#### عتبة البطء
- الافتراضي: 1 ثانية
- يمكن تغييرها في الإعدادات

#### تحليل استعلام بطيء
```sql
EXPLAIN ANALYZE SELECT * FROM orders 
  JOIN customers ON orders.customer_id = customers.id
  WHERE orders.status = 'pending';
```

**قراءة النتيجة**:
- **Seq Scan**: مسح كامل للجدول (بطيء)
- **Index Scan**: استخدام فهرس (سريع)
- **Cost**: تكلفة تقديرية
- **Rows**: عدد الصفوف

### إحصائيات الأداء

#### المقاييس المتاحة
1. **متوسط وقت الاستجابة**: لكل نوع استعلام
2. **عدد الاستعلامات**: في الساعة/اليوم
3. **نسبة استخدام الذاكرة**: للتخزين المؤقت
4. **معدل النجاح**: نسبة الاستعلامات الناجحة

#### تحسين الأداء
```
المشكلة: استعلام بطيء على جدول كبير
الحل: إنشاء فهرس على الأعمدة المستخدمة في WHERE

المشكلة: استخدام SELECT *
الحل: حدد الأعمدة المطلوبة فقط

المشكلة: عدم استخدام LIMIT
الحل: استخدم LIMIT للنتائج الكبيرة
```

## التحقق من صحة البيانات

### إنشاء قواعد التحقق

#### 1. التحقق من النطاق (Range)
```json
{
  "tableName": "products",
  "columnName": "price",
  "validationType": "range",
  "config": {
    "min": 0,
    "max": 1000000
  },
  "errorMessage": "السعر يجب أن يكون بين 0 و 1000000"
}
```

#### 2. التحقق من التعبير النمطي (Regex)
```json
{
  "tableName": "users",
  "columnName": "email",
  "validationType": "regex",
  "config": {
    "pattern": "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$"
  },
  "errorMessage": "البريد الإلكتروني غير صالح"
}
```

#### 3. التحقق من القيم المسموحة (Enum)
```json
{
  "tableName": "orders",
  "columnName": "status",
  "validationType": "enum",
  "config": {
    "allowedValues": ["pending", "processing", "completed", "cancelled"]
  },
  "errorMessage": "الحالة غير صالحة"
}
```

#### 4. التحقق المخصص (Custom)
```json
{
  "tableName": "events",
  "columnName": "end_date",
  "validationType": "custom",
  "config": {
    "expression": "end_date > start_date"
  },
  "errorMessage": "تاريخ النهاية يجب أن يكون بعد تاريخ البداية"
}
```

### تشغيل التحقق

#### التحقق اليدوي
1. اختر الجدول
2. انقر "Data Validation"
3. انقر "Run Validation"
4. شاهد النتائج والأخطاء

#### التحقق التلقائي
- يتم التحقق تلقائياً عند INSERT/UPDATE
- الصفوف غير الصالحة تُرفض
- رسائل خطأ واضحة

## النسخ الاحتياطي المتقدم

### استراتيجيات النسخ الاحتياطي

#### 1. نسخة كاملة (Full Backup)
```
التكرار: يومي أو أسبوعي
المحتوى: جميع الجداول والبيانات
الحجم: كبير
وقت الاستعادة: سريع
```

#### 2. نسخة تزايدية (Incremental)
```
التكرار: كل ساعة
المحتوى: التغييرات فقط منذ آخر نسخة
الحجم: صغير
وقت الاستعادة: متوسط
```

#### 3. نسخة تفاضلية (Differential)
```
التكرار: يومي
المحتوى: التغييرات منذ آخر نسخة كاملة
الحجم: متوسط
وقت الاستعادة: متوسط
```

### خيارات النسخ الاحتياطي

#### مع المخطط (Schema)
```
✅ البنية الكاملة للجداول
✅ الفهارس
✅ القيود
✅ المشغلات (Triggers)
```

#### البيانات فقط
```
✅ محتوى الجداول فقط
❌ بدون بنية
مفيد: للاستيراد في قاعدة بيانات موجودة
```

#### جداول محددة
```
اختر الجداول المهمة فقط
تقليل حجم النسخة الاحتياطية
نسخ احتياطي سريع
```

## تحليل الجداول

### الإحصائيات المتاحة

#### 1. معلومات أساسية
- عدد الصفوف الكلي
- عدد الأعمدة
- حجم الجدول (بالـ MB)
- تاريخ الإنشاء/التعديل

#### 2. تحليل البيانات
- توزيع القيم في كل عمود
- القيم الفارغة (NULL)
- القيم الفريدة
- القيم الأكثر تكراراً

#### 3. تحليل الأداء
- الفهارس المستخدمة
- نسبة استخدام الفهارس
- الاستعلامات البطيئة على هذا الجدول

#### 4. اقتراحات التحسين
- فهارس مقترحة
- أعمدة غير مستخدمة
- تحسينات هيكلية

### استخدام التحليل

```
1. اختر الجدول
2. انقر "Analyze Table"
3. انتظر اكتمال التحليل
4. راجع النتائج والاقتراحات
5. طبّق التحسينات الموصى بها
```

## أفضل الممارسات

### الأمان
- ✅ قم بنسخ احتياطي قبل العمليات الكبيرة
- ✅ استخدم المعاملات (Transactions) للعمليات المعقدة
- ✅ احتفظ بسجل للتغييرات المهمة

### الأداء
- ✅ راقب الاستعلامات البطيئة بانتظام
- ✅ احذف الفهارس غير المستخدمة
- ✅ نظّف البيانات القديمة

### الصيانة
- ✅ قم بتحليل الجداول شهرياً
- ✅ راجع الإحصائيات دورياً
- ✅ حدّث الفهارس حسب الحاجة

---

**المطور**: عبدالعزيز القديمي  
**البريد الإلكتروني**: eng7mi@gmail.com, alqudimitechnology@gmail.com  
**GitHub**: [@Alqudimi](https://github.com/Alqudimi)  
**جميع الحقوق محفوظة © 2024 - تقنية القديمي**
